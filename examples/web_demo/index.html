<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GestureEngine â€” Live Demo</title>
<style>
  :root {
    --bg: #0a0a0f;
    --surface: #13131a;
    --border: #1e1e2e;
    --text: #e0e0e8;
    --muted: #6b6b80;
    --accent: #6c63ff;
    --accent-glow: rgba(108, 99, 255, 0.3);
    --green: #22c55e;
    --red: #ef4444;
    --yellow: #eab308;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'SF Mono', 'Fira Code', 'Cascadia Code', monospace;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    overflow-x: hidden;
  }

  .header {
    padding: 24px 32px;
    border-bottom: 1px solid var(--border);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .header h1 {
    font-size: 18px;
    font-weight: 600;
    letter-spacing: -0.5px;
  }

  .header h1 span { color: var(--accent); }

  .status {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 13px;
    color: var(--muted);
  }

  .status-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--red);
    transition: background 0.3s;
  }

  .status-dot.connected { background: var(--green); box-shadow: 0 0 8px var(--green); }

  .main {
    display: grid;
    grid-template-columns: 1fr 320px;
    gap: 0;
    min-height: calc(100vh - 73px);
  }

  .center {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 48px;
    gap: 32px;
  }

  .gesture-display {
    text-align: center;
  }

  .gesture-name {
    font-size: 64px;
    font-weight: 700;
    letter-spacing: -2px;
    color: var(--accent);
    text-shadow: 0 0 40px var(--accent-glow);
    transition: all 0.15s ease;
    min-height: 80px;
  }

  .gesture-name.sequence {
    color: var(--yellow);
    text-shadow: 0 0 40px rgba(234, 179, 8, 0.3);
  }

  .gesture-emoji {
    font-size: 96px;
    margin-bottom: 16px;
    min-height: 110px;
    display: block;
  }

  .confidence-bar {
    margin-top: 16px;
    width: 300px;
    height: 4px;
    background: var(--border);
    border-radius: 2px;
    overflow: hidden;
    margin-left: auto;
    margin-right: auto;
  }

  .confidence-fill {
    height: 100%;
    background: var(--accent);
    border-radius: 2px;
    transition: width 0.15s ease;
    width: 0%;
  }

  .confidence-label {
    font-size: 13px;
    color: var(--muted);
    margin-top: 8px;
  }

  .metrics {
    display: flex;
    gap: 32px;
  }

  .metric {
    text-align: center;
  }

  .metric-value {
    font-size: 28px;
    font-weight: 600;
    color: var(--text);
  }

  .metric-label {
    font-size: 11px;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-top: 4px;
  }

  .sidebar {
    border-left: 1px solid var(--border);
    display: flex;
    flex-direction: column;
  }

  .sidebar-header {
    padding: 16px 20px;
    border-bottom: 1px solid var(--border);
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--muted);
  }

  .timeline {
    flex: 1;
    overflow-y: auto;
    padding: 8px 0;
  }

  .timeline-item {
    padding: 10px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid var(--border);
    animation: slideIn 0.2s ease;
  }

  .timeline-item.sequence-item {
    background: rgba(234, 179, 8, 0.05);
  }

  @keyframes slideIn {
    from { opacity: 0; transform: translateX(10px); }
    to { opacity: 1; transform: translateX(0); }
  }

  .timeline-gesture {
    font-weight: 600;
    font-size: 14px;
  }

  .timeline-gesture.seq { color: var(--yellow); }

  .timeline-meta {
    text-align: right;
    font-size: 11px;
    color: var(--muted);
  }

  .timeline-confidence {
    display: inline-block;
    width: 40px;
    height: 3px;
    background: var(--border);
    border-radius: 1.5px;
    overflow: hidden;
    vertical-align: middle;
    margin-left: 6px;
  }

  .timeline-confidence-fill {
    height: 100%;
    background: var(--accent);
    border-radius: 1.5px;
  }

  .no-gesture {
    color: var(--muted);
    font-size: 14px;
    text-align: center;
    padding: 48px 20px;
  }

  @media (max-width: 768px) {
    .main { grid-template-columns: 1fr; }
    .sidebar { border-left: none; border-top: 1px solid var(--border); max-height: 250px; }
    .gesture-name { font-size: 40px; }
    .gesture-emoji { font-size: 64px; }
    .center { padding: 24px; }
  }
</style>
</head>
<body>

<div class="header">
  <h1><span>Gesture</span>Engine</h1>
  <div class="status">
    <div class="status-dot" id="statusDot"></div>
    <span id="statusText">Connecting...</span>
  </div>
</div>

<div class="main">
  <div class="center">
    <div class="gesture-display">
      <span class="gesture-emoji" id="gestureEmoji">ðŸ‘‹</span>
      <div class="gesture-name" id="gestureName">Waiting...</div>
      <div class="confidence-bar">
        <div class="confidence-fill" id="confidenceFill"></div>
      </div>
      <div class="confidence-label" id="confidenceLabel">â€”</div>
    </div>

    <div class="metrics">
      <div class="metric">
        <div class="metric-value" id="fpsValue">â€”</div>
        <div class="metric-label">FPS</div>
      </div>
      <div class="metric">
        <div class="metric-value" id="latencyValue">â€”</div>
        <div class="metric-label">Latency</div>
      </div>
      <div class="metric">
        <div class="metric-value" id="handsValue">0</div>
        <div class="metric-label">Hands</div>
      </div>
      <div class="metric">
        <div class="metric-value" id="totalValue">0</div>
        <div class="metric-label">Events</div>
      </div>
    </div>
  </div>

  <div class="sidebar">
    <div class="sidebar-header">Event Timeline</div>
    <div class="timeline" id="timeline">
      <div class="no-gesture">No gestures detected yet</div>
    </div>
  </div>
</div>

<script>
const EMOJI_MAP = {
  open_hand: 'ðŸ–ï¸', fist: 'âœŠ', thumbs_up: 'ðŸ‘', peace: 'âœŒï¸',
  pointing: 'ðŸ‘†', rock_on: 'ðŸ¤˜', ok_sign: 'ðŸ‘Œ',
  release: 'ðŸ«³', grab: 'ðŸ¤', pinch_release: 'ðŸ«´',
  peace_out: 'ðŸ¤ž', wave: 'ðŸ‘‹', point_and_click: 'ðŸ–±ï¸',
};

const wsUrl = `ws://${location.host}/ws`;
let ws;
let totalEvents = 0;
let reconnectTimer;

function connect() {
  ws = new WebSocket(wsUrl);

  ws.onopen = () => {
    document.getElementById('statusDot').classList.add('connected');
    document.getElementById('statusText').textContent = 'Connected';
    clearTimeout(reconnectTimer);
  };

  ws.onclose = () => {
    document.getElementById('statusDot').classList.remove('connected');
    document.getElementById('statusText').textContent = 'Reconnecting...';
    reconnectTimer = setTimeout(connect, 2000);
  };

  ws.onerror = () => ws.close();

  ws.onmessage = (e) => {
    const msg = JSON.parse(e.data);

    if (msg.type === 'gesture') {
      totalEvents++;
      document.getElementById('gestureEmoji').textContent = EMOJI_MAP[msg.gesture] || 'ðŸ¤š';
      const nameEl = document.getElementById('gestureName');
      nameEl.textContent = msg.gesture.replace(/_/g, ' ');
      nameEl.classList.remove('sequence');
      document.getElementById('confidenceFill').style.width = (msg.confidence * 100) + '%';
      document.getElementById('confidenceLabel').textContent = (msg.confidence * 100).toFixed(0) + '% confidence';
      document.getElementById('totalValue').textContent = totalEvents;

      addTimelineItem(msg.gesture, msg.confidence, false);
    }

    if (msg.type === 'sequence') {
      totalEvents++;
      document.getElementById('gestureEmoji').textContent = EMOJI_MAP[msg.sequence] || 'âš¡';
      const nameEl = document.getElementById('gestureName');
      nameEl.textContent = msg.sequence.replace(/_/g, ' ');
      nameEl.classList.add('sequence');
      document.getElementById('confidenceLabel').textContent = `sequence: ${msg.gestures.join(' â†’ ')}`;
      document.getElementById('totalValue').textContent = totalEvents;

      addTimelineItem(msg.sequence, null, true);
    }

    if (msg.type === 'stats') {
      document.getElementById('fpsValue').textContent = msg.fps.toFixed(0);
      document.getElementById('latencyValue').textContent = msg.latency_ms.toFixed(0) + 'ms';
      document.getElementById('handsValue').textContent = msg.hands_detected;
    }

    if (msg.type === 'ping') {
      ws.send(JSON.stringify({ type: 'ping' }));
    }
  };
}

function addTimelineItem(name, confidence, isSequence) {
  const timeline = document.getElementById('timeline');
  const noGesture = timeline.querySelector('.no-gesture');
  if (noGesture) noGesture.remove();

  const item = document.createElement('div');
  item.className = 'timeline-item' + (isSequence ? ' sequence-item' : '');

  const now = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });

  let confHtml = '';
  if (confidence !== null) {
    confHtml = `<div class="timeline-confidence"><div class="timeline-confidence-fill" style="width:${confidence*100}%"></div></div>`;
  }

  item.innerHTML = `
    <span class="timeline-gesture ${isSequence ? 'seq' : ''}">${isSequence ? 'âš¡ ' : ''}${name.replace(/_/g, ' ')}</span>
    <span class="timeline-meta">${now}${confHtml}</span>
  `;

  timeline.insertBefore(item, timeline.firstChild);

  // Keep max 50 items
  while (timeline.children.length > 50) {
    timeline.removeChild(timeline.lastChild);
  }
}

connect();
</script>
</body>
</html>
